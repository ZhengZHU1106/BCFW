# 奖金池算法说明文档

## 概述

奖金池机制是区块链智能安防平台的核心激励系统，旨在通过基于贡献度的公平奖励分配，激励Manager积极参与威胁提案的审批和签名。

## 算法设计原则

1. **公平性**：基于实际贡献进行奖励分配
2. **透明性**：所有计算公式公开透明
3. **实时性**：适合现场演示的即时反馈
4. **简洁性**：易于理解和验证

## 核心算法

### 1. 质量评分算法（0-100分）

质量评分由响应速度分和活跃度分组成：

```
质量评分 = 响应速度分(60%) + 活跃度分(40%)
```

#### 1.1 响应速度分计算（60分满分）

根据Manager签名提案的响应时间计算：

- **10秒内响应**：60分（满分）
- **30秒内响应**：50分  
- **1分钟内响应**：40分
- **2分钟内响应**：30分
- **5分钟内响应**：20分
- **超过5分钟**：10分

#### 1.2 活跃度分计算（40分满分）

根据Manager最近签名活动计算：

- **最近10分钟内有签名**：40分（满分）
- **最近30分钟内有签名**：30分
- **最近1小时内有签名**：20分
- **超过1小时**：10分
- **首次签名**：40分（满分）

### 2. 贡献度计算算法（0-100分）

贡献度由签名次数得分和质量评分组成：

```
贡献度 = 签名次数得分(50%) + 质量评分(50%)
```

#### 2.1 签名次数得分计算

```
签名次数得分 = min(100, 签名次数 × 10)
```

- **10次签名**：100分（满分）
- **5次签名**：50分
- **1次签名**：10分

#### 2.2 最终贡献度公式

```
贡献度 = 签名次数得分 × 0.5 + 质量评分 × 0.5
```

### 3. 奖励分配算法

#### 3.1 触发条件

- **自动触发**：每当有提案执行完成时
- **分配金额**：固定1 ETH
- **参与条件**：只有贡献度 > 0（即有签名记录）的Manager参与

#### 3.2 分配公式

```
个人奖励 = (个人贡献度 / 所有参与Manager贡献度总和) × 1 ETH
```

#### 3.3 最小奖励阈值

- 个人奖励 < 0.001 ETH 时不予发放（避免微小转账）

## 演示场景举例

### 场景1：响应速度影响奖励分配

**提案创建时间：** 14:00:00

| Manager | 签名时间 | 响应时间 | 速度分 | 活跃度分 | 质量评分 | 签名次数 | 贡献度 | 奖励比例 |
|---------|----------|----------|--------|----------|----------|----------|--------|----------|
| Manager_0 | 14:00:05 | 5秒 | 60 | 40 | 100 | 1 | 55.0 | 52.4% |
| Manager_1 | 14:00:45 | 45秒 | 40 | 40 | 80 | 1 | 50.0 | 47.6% |
| Manager_2 | - | - | - | - | - | 0 | 0 | 不参与 |

**分配结果：**
- Manager_0：0.524 ETH
- Manager_1：0.476 ETH

### 场景2：多次签名累积优势

**经过5个提案后：**

| Manager | 签名次数 | 签名得分 | 平均质量 | 贡献度 | 奖励比例 |
|---------|----------|----------|----------|--------|----------|
| Manager_0 | 5 | 50 | 95 | 72.5 | 41.4% |
| Manager_1 | 3 | 30 | 85 | 57.5 | 32.9% |
| Manager_2 | 2 | 20 | 70 | 45.0 | 25.7% |

**分配结果：**
- Manager_0：0.414 ETH
- Manager_1：0.329 ETH  
- Manager_2：0.257 ETH

## 奖金池管理

### 初始化

- **启动时自动充值**：系统启动时检查奖金池余额，如低于50 ETH则自动充值至100 ETH
- **资金来源**：Treasury账户

### 充值机制

- **手动充值**：管理员可通过前端Dashboard向奖金池充值
- **充值API**：`POST /api/reward-pool/deposit`

### 余额监控

- **实时显示**：前端Dashboard实时显示奖金池余额、基础奖励等信息
- **充足保障**：100 ETH初始余额足够长期演示使用

## 技术实现

### 后端实现

1. **质量评分**：`backend/blockchain/multisig_contract.py` - `_calculate_quality_score`
2. **贡献度计算**：`backend/app/services.py` - `_calculate_contribution_score`
3. **自动分配**：`backend/app/services.py` - `_auto_distribute_on_execution`

### 前端展示

1. **奖金池状态**：余额、基础奖励、Treasury余额
2. **Manager贡献**：签名次数、质量评分、性能等级
3. **自动分配提示**：说明奖励自动分配机制

## 系统优势

1. **解决游戏化问题**：避免Manager为获得"最终签名者"奖励而故意延迟签名
2. **激励积极参与**：响应速度快、参与次数多的Manager获得更多奖励
3. **公平透明**：所有计算过程透明，贡献与奖励成正比
4. **适合演示**：实时计算，立即生效，适合现场演示展示

## 扩展性

该算法设计为模块化结构，可根据需要调整：

- **权重调整**：可修改响应速度分与活跃度分的权重比例
- **奖励金额**：可调整每次分配的固定金额
- **评分标准**：可修改响应时间的评分区间
- **触发条件**：可增加定时分配等其他触发方式

---

*本文档记录了奖金池算法的完整设计和实现细节，为系统的持续优化和功能扩展提供参考。*