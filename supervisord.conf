[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisord]
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=/var/run/supervisord.pid
nodaemon=true
minfds=1024
minprocs=200

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

# Ganache 区块链服务
[program:ganache]
command=ganache --mnemonic "bulk tonight audit hover toddler orange boost twenty biology flower govern soldier" --blockTime 5 --host 0.0.0.0 --port 8545 --accounts 10 --defaultBalanceEther 1000
directory=/app
user=root
autostart=true
autorestart=true
stderr_logfile=/app/logs/ganache_err.log
stdout_logfile=/app/logs/ganache_out.log
priority=100
startsecs=10
startretries=3

# 合约部署服务（一次性任务）
[program:contract-deploy]
command=node scripts/deploy_multisig_simple.js
directory=/app
user=root
autostart=true
autorestart=false
stderr_logfile=/app/logs/contract_deploy_err.log
stdout_logfile=/app/logs/contract_deploy_out.log
priority=200
startsecs=5
startretries=2

# FastAPI 后端服务
[program:backend]
command=python3 -m uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload
directory=/app
user=root
autostart=true
autorestart=true
stderr_logfile=/app/logs/backend_err.log
stdout_logfile=/app/logs/backend_out.log
priority=300
startsecs=15
startretries=3

# 前端Web服务
[program:frontend]
command=python3 -m http.server 5173 --bind 0.0.0.0
directory=/app/frontend/dist
user=root
autostart=true
autorestart=true
stderr_logfile=/app/logs/frontend_err.log
stdout_logfile=/app/logs/frontend_out.log
priority=400
startsecs=5
startretries=3

# 依赖关系配置
[group:bcfw-stack]
programs=ganache,backend,frontend
priority=999